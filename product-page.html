<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Shop</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 12px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; }
    button { padding: 8px 10px; cursor: pointer; }
    .cart { margin-top: 18px; border-top: 1px solid #ddd; padding-top: 12px; }
    .row { display:flex; justify-content:space-between; align-items:center; margin: 6px 0; }
  </style>
</head>
<body>

<h2>Products</h2>
<div id="products" class="grid"></div>

<div class="cart">
  <h3>Cart</h3>
  <div id="cart"></div>
  <p><b>Total:</b> <span id="total">0</span></p>
  <button id="sendBtn">Send order to my email</button>
  <button id="clearBtn">Clear cart</button>
</div>

<script>
  const YOUR_EMAIL = "youremail@example.com"; // <-- change to your mailbox

  const productList = [
    { id: 1, name: "White Keeri Samba 8 LB", price: 2500 },
    { id: 2, name: "Sugar 1 KG", price: 420 },
    { id: 3, name: "Tea 200g", price: 650 },
  ];

  const cartKey = "cart_v1";

  function loadCart() {
    return JSON.parse(localStorage.getItem(cartKey) || "[]");
  }
  function saveCart(cart) {
    localStorage.setItem(cartKey, JSON.stringify(cart));
  }

  function addToCart(product) {
    const cart = loadCart();
    const existing = cart.find(i => i.id === product.id);
    if (existing) existing.qty += 1;
    else cart.push({ ...product, qty: 1 });
    saveCart(cart);
    renderCart();
  }

  function removeOne(id) {
    const cart = loadCart();
    const item = cart.find(i => i.id === id);
    if (!item) return;
    item.qty -= 1;
    const newCart = item.qty <= 0 ? cart.filter(i => i.id !== id) : cart;
    saveCart(newCart);
    renderCart();
  }

  function clearCart() {
    saveCart([]);
    renderCart();
  }

  function renderProducts() {
    const el = document.getElementById("products");
    el.innerHTML = productList.map(p => `
      <div class="card">
        <div><b>${p.name}</b></div>
        <div>Rs. ${p.price}</div>
        <button onclick="addToCart(${p.id})">Add</button>
      </div>
    `).join("");

    // expose for inline onclick
    window.addToCart = (id) => addToCart(productList.find(p => p.id === id));
  }

  function renderCart() {
    const cart = loadCart();
    const cartEl = document.getElementById("cart");
    if (cart.length === 0) {
      cartEl.innerHTML = "<i>No items yet</i>";
      document.getElementById("total").textContent = "0";
      return;
    }

    let total = 0;
    cartEl.innerHTML = cart.map(i => {
      const line = i.price * i.qty;
      total += line;
      return `
        <div class="row">
          <div>${i.name} Ã— ${i.qty}</div>
          <div>
            Rs. ${line}
            <button onclick="removeOne(${i.id})">-</button>
          </div>
        </div>
      `;
    }).join("");

    window.removeOne = removeOne;
    document.getElementById("total").textContent = total;
  }

  function buildEmailText() {
    const cart = loadCart();
    let total = 0;

    const lines = cart.map(i => {
      const line = i.price * i.qty;
      total += line;
      return `${i.name} x ${i.qty} = Rs. ${line}`;
    });

    lines.push("");
    lines.push(`TOTAL = Rs. ${total}`);
    lines.push("");
    lines.push("Customer details:");
    lines.push("Name: ");
    lines.push("Phone: ");
    lines.push("Address: ");

    return lines.join("\n");
  }

  document.getElementById("sendBtn").addEventListener("click", () => {
    const cart = loadCart();
    if (cart.length === 0) return alert("Cart is empty.");

    const subject = encodeURIComponent("New Order");
    const body = encodeURIComponent(buildEmailText());

    // Opens user's mail client with prefilled content
    window.location.href = `mailto:${YOUR_EMAIL}?subject=${subject}&body=${body}`;
  });

  document.getElementById("clearBtn").addEventListener("click", clearCart);

  renderProducts();
  renderCart();
</script>

</body>
</html>
